<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ã‚¬ãƒãƒ£</title>

<style>
  body {
    font-family: 'Noto Sans JP', sans-serif;
    background: #fbf4dd;
    text-align: center;
    padding: 20px;
  }

  h1 {
    font-size: 32px;
    margin-bottom: 10px;
  }

  #egg {
    width: 200px;
    transition: transform 0.3s ease;
  }

  .shake {
    animation: shake 0.4s infinite;
  }

  @keyframes shake {
    0% { transform: translate(0,0) rotate(0); }
    25% { transform: translate(3px,-2px) rotate(1deg); }
    50% { transform: translate(-3px,2px) rotate(-1deg); }
    75% { transform: translate(2px,-3px) rotate(1deg); }
    100% { transform: translate(0,0) rotate(0); }
  }

  #resultImg {
    width: 260px;
    display: none;
    margin: 20px auto;
  }

  #resultText {
    font-size: 24px;
    margin-top: 10px;
    font-weight: bold;
    color: #4b7b3a;
    display: none;
  }

  #gachaBtn {
    margin-top: 20px;
    padding: 14px 28px;
    font-size: 22px;
    background: #7cc76c;
    border-radius: 12px;
    color: white;
    border: none;
  }

  #backBtn {
    position: fixed;
    top: 15px;
    left: 15px;
    background: #4c8f3a;
    color: white;
    padding: 10px 18px;
    border-radius: 20px;
    text-decoration: none;
  }
</style>
</head>

<body>

<a id="backBtn" href="index.html">â† ã‚‚ã©ã‚‹</a>

<h1>ğŸ¥šã‚¬ãƒãƒ£</h1>

<div id="gachaArea">
  <img id="egg" src="images/0egg.png">
  <button id="gachaBtn" onclick="startGacha()">ã‚¬ãƒãƒ£ã‚’å›ã™</button>
  <img id="resultImg">
  <div id="resultText"></div>
</div>

<script>
/* ---------- ã‚«ãƒ¼ãƒ‰ä¸€è¦§ï¼ˆ33ç¨®é¡ï¼‰ ---------- */
const cards = [
  /* æç«œ */
  { id: "tira", name: "ãƒ†ã‚£ãƒ©ãƒã‚µã‚¦ãƒ«ã‚¹", rare: 5, img: "images/tira.png" },
  { id: "tori", name: "ãƒˆãƒªã‚±ãƒ©ãƒˆãƒ—ã‚¹", rare: 4, img: "images/tori.png" },
  { id: "ste", name: "ã‚¹ãƒ†ã‚´ã‚µã‚¦ãƒ«ã‚¹", rare: 3, img: "images/ste.png" },
  { id: "bra", name: "ãƒ–ãƒ©ã‚­ã‚ªã‚µã‚¦ãƒ«ã‚¹", rare: 3, img: "images/bra.png" },
  { id: "pte", name: "ãƒ—ãƒ†ãƒ©ãƒãƒ‰ãƒ³", rare: 2, img: "images/pte.png" },
  { id: "spi", name: "ã‚¹ãƒ”ãƒã‚µã‚¦ãƒ«ã‚¹", rare: 5, img: "images/spi.png" },
  { id: "an",  name: "ã‚¢ãƒ³ã‚­ãƒ­ã‚µã‚¦ãƒ«ã‚¹", rare: 2, img: "images/an.png" },
  { id: "para", name: "ãƒ‘ãƒ©ã‚µã‚¦ãƒ­ãƒ­ãƒ•ã‚¹", rare: 4, img: "images/para.png" },
  { id: "igu",  name: "ã‚¤ã‚°ã‚¢ãƒãƒ‰ãƒ³", rare: 2, img: "images/igu.png" },
  { id: "vero", name: "ãƒ´ã‚§ãƒ­ã‚­ãƒ©ãƒ—ãƒˆãƒ«", rare: 4, img: "images/vero.png" },

  /* æµ·ã®ç”Ÿãç‰© */
  { id: "tako", name: "ã‚¿ã‚³", rare: 2, img: "images/tako.png" },
  { id: "same", name: "ã‚µãƒ¡", rare: 4, img: "images/same.png" },
  { id: "iruka", name: "ã‚¤ãƒ«ã‚«", rare: 3, img: "images/iruka.png" },
  { id: "kumanomi", name: "ã‚«ã‚¯ãƒ¬ã‚¯ãƒãƒãƒŸ", rare: 2, img: "images/kumanomi.png" },
  { id: "kurage", name: "ã‚¯ãƒ©ã‚²", rare: 1, img: "images/kurage.png" },
  { id: "manta", name: "ãƒãƒ³ã‚¿", rare: 3, img: "images/manta.png" },
  { id: "hitode", name: "ãƒ’ãƒˆãƒ‡", rare: 1, img: "images/hitode.png" },
  { id: "secret", name: "ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ", rare: 5, img: "images/secret.png" },
  { id: "ika", name: "ã‚¤ã‚«", rare: 2, img: "images/ika.png" },
  { id: "rakko", name: "ãƒ©ãƒƒã‚³", rare: 3, img: "images/rakko.png" },
  { id: "kame", name: "ã‚«ãƒ¡", rare: 3, img: "images/kame.png" },

  /* æ˜†è™« */
  { id: "tyo", name: "è¶ã€…", rare: 1, img: "images/tyo.png" },
  { id: "kabu", name: "ã‚«ãƒ–ãƒˆãƒ ã‚·", rare: 4, img: "images/kabu.png" },
  { id: "ton", name: "ãƒˆãƒ³ãƒœ", rare: 2, img: "images/ton.png" },
  { id: "tento", name: "ã¦ã‚“ã¨ã†è™«", rare: 1, img: "images/tento.png" },
  { id: "kama", name: "ã‚«ãƒã‚­ãƒª", rare: 3, img: "images/kama.png" },
  { id: "kuwa", name: "ã‚¯ãƒ¯ã‚¬ã‚¿", rare: 4, img: "images/kuwa.png" },
  { id: "hachi", name: "ãƒãƒ", rare: 2, img: "images/hachi.png" },
  { id: "kata", name: "ã‚«ã‚¿ãƒ„ãƒ ãƒª", rare: 1, img: "images/kata.png" },
  { id: "imo", name: "èŠ‹è™«", rare: 1, img: "images/imo.png" },
  { id: "semi", name: "ã‚»ãƒŸ", rare: 2, img: "images/semi.png" },
  { id: "bata", name: "ãƒãƒƒã‚¿", rare: 2, img: "images/bata.png" }
];

/* ---------- å›³é‘‘ã«ç™»éŒ² ---------- */
function addToZukan(card) {
  let zukan = JSON.parse(localStorage.getItem("zukan") || "{}");

  if (zukan[card.id]) {
    zukan[card.id].count++;
  } else {
    zukan[card.id] = {
      name: card.name,
      img: card.img,
      rare: card.rare,
      count: 1
    };
  }

  localStorage.setItem("zukan", JSON.stringify(zukan));
}

/* ---------- ãƒ¬ã‚¢åº¦ â†’ é‡ã¿ ---------- */
function getWeight(rare) {
  switch (rare) {
    case 1: return 5;
    case 2: return 3;
    case 3: return 2;
    case 4: return 1;
    case 5: return 0.5;
  }
}

/* ---------- ã‚¬ãƒãƒ£æŠ½é¸ ---------- */
function rollGacha() {

  /* --- secret 1% --- */
  if (Math.random() < 0.01) {
    return cards.find(c => c.id === "secret");
  }

  /* --- æ®‹ã‚Š99ï¼… â†’ é‡ã¿ä»˜ãæŠ½é¸ --- */
  let pool = [];

  cards.forEach(card => {
    if (card.id === "secret") return; // secretã¯é™¤å¤–

    const weight = getWeight(card.rare);
    for (let i = 0; i < weight * 10; i++) {
      pool.push(card);
    }
  });

  return pool[Math.floor(Math.random() * pool.length)];
}

/* ---------- ç·´ç¿’å›æ•°ãƒã‚§ãƒƒã‚¯ ---------- */
let count = Number(localStorage.getItem("practiceCount") || 0);

if (count < 10) {
  document.getElementById("gachaArea").innerHTML = `
    <h2>ã‚¬ãƒãƒ£ã¯ã¾ã å›ã›ã¾ã›ã‚“ğŸ¥²</h2>
    <p style="font-size:22px; color:#555;">ã‚ã¨ <b>${10 - count}</b> å› ãªãã‚Šç·´ç¿’ãŒå¿…è¦ã§ã™</p>
    <a href="hiragana.html"
       style="display:inline-block;margin-top:30px;background:#4c8f3a;color:white;padding:15px 25px;border-radius:10px;text-decoration:none;">
       ã‚Œã‚“ã—ã‚…ã†ãƒšãƒ¼ã‚¸ã¸
    </a>
  `;
}

/* ---------- ã‚¬ãƒãƒ£é–‹å§‹ ---------- */
function startGacha() {

  let count = Number(localStorage.getItem("practiceCount") || 0);
  if (count < 10) {
    alert("ç·´ç¿’ãŒè¶³ã‚Šã¾ã›ã‚“ï¼");
    return;
  }

  localStorage.setItem("practiceCount", count - 10);

  const egg = document.getElementById("egg");
  egg.classList.add("shake");

  /* åµæ¼”å‡º */
  setTimeout(() => {
    egg.src = "images/egg.png";
  }, 600);

  setTimeout(() => {
    egg.style.display = "none";

    /* --- é«˜æ©Ÿèƒ½æŠ½é¸ --- */
    const result = rollGacha();

    /* çµæœåæ˜  */
    const resultImg = document.getElementById("resultImg");
    const resultText = document.getElementById("resultText");

    resultImg.src = result.img;
    resultImg.style.display = "block";

    resultText.textContent = `${result.name}ï¼ˆâ˜…${result.rare}ï¼‰ãŒå‡ºãŸï¼`;
    resultText.style.display = "block";

    addToZukan(result);

  }, 1200);
}
</script>

</body>
</html>
