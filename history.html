<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã‚Œã‚“ã—ã‚…ã†ãã‚ã</title>

<style>
  body {
    background:#fff6e0;
    font-family:"Kosugi Maru",sans-serif;
    text-align:center;
    margin:0;
    padding-bottom:30px;
  }

  #backBtn {
    position:absolute;
    left:10px;
    top:10px;
    font-size:18px;
    color:#4c8f3a;
    text-decoration:none;
  }

  h2 {
    color:#4c8f3a;
    margin-top:50px;
  }

  /* ãƒŠãƒ“ï¼ˆå‰ã®é€± / æ¬¡ã®é€±ï¼‰ */
  .week-nav {
    width:90%;
    max-width:420px;
    margin:10px auto;
    display:flex;
    justify-content:space-between;
    font-size:20px;
    color:#4c8f3a;
    user-select:none;
  }
  .nav-btn { cursor:pointer; padding:5px 10px; }

  /* 1é€±é–“ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ */
  .calendar {
    width:95%;
    max-width:500px;
    margin:20px auto;
    background:white;
    padding:15px;
    border-radius:20px;
    box-shadow:0 3px 6px rgba(0,0,0,0.2);
    animation:fadein 0.4s ease;
  }

  @keyframes fadein {
    from {opacity:0; transform:translateY(10px);}
    to   {opacity:1; transform:translateY(0);}
  }

  .weekdays {
    display:grid;
    grid-template-columns: repeat(7, 1fr);
    margin-bottom:10px;
    font-weight:bold;
  }
  .weekday:nth-child(1){ color:#d64a4a; } /* æ—¥æ›œ */
  .weekday:nth-child(7){ color:#4a6cd6; } /* åœŸæ›œ */

  .days {
    display:grid;
    grid-template-columns: repeat(7, 1fr);
    gap:10px;
  }

  .day {
    background:white;
    height:100px;
    border-radius:14px;
    padding:5px 0;
    box-shadow:0 2px 4px rgba(0,0,0,0.1);
    font-size:18px;
    position:relative;
    transition:transform 0.15s;
  }
  .day:hover { transform:scale(1.03); }

  .today { border:3px solid #ffb03a; }

  .count {
    font-size:14px;
    color:#4c8f3a;
    margin-top:5px;
  }

  .stamp {
    width:35px;
    position:absolute;
    bottom:6px;
    right:6px;
    animation:pop 0.4s ease;
  }

  @keyframes pop {
    0% {transform:scale(0);}
    70%{transform:scale(1.2);}
    100%{transform:scale(1);}
  }

  #backBtn {
    position: fixed;
    top: 15px;
    left: 15px;
    background: #4c8f3a;
    color: white;
    padding: 10px 18px;
    border-radius: 20px;
    text-decoration: none;
  }
</style>
</head>

<body>

<a id="backBtn" href="index.html">â† ã‚‚ã©ã‚‹</a>

<h2>ğŸ“… ã‚Œã‚“ã—ã‚…ã†ãã‚ã</h2>

<div class="week-nav">
  <div class="nav-btn" id="prev">ã€ˆ ã¾ãˆã®ã—ã‚…ã†</div>
  <div id="weekTitle"></div>
  <div class="nav-btn" id="next">ã¤ãã®ã—ã‚…ã† ã€‰</div>
</div>

<div class="calendar">
  <div class="weekdays">
    <div class="weekday">æ—¥</div><div class="weekday">æœˆ</div><div class="weekday">ç«</div>
    <div class="weekday">æ°´</div><div class="weekday">æœ¨</div><div class="weekday">é‡‘</div><div class="weekday">åœŸ</div>
  </div>
  <div class="days" id="days"></div>
</div>

<script>
/* =====================================
   1é€±é–“ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼
===================================== */

const daysEl = document.getElementById("days");
const weekTitle = document.getElementById("weekTitle");
const history = JSON.parse(localStorage.getItem("history") || "{}");

let current = new Date(); // é€±ã®åŸºæº–

/* ---- é€±ã®é–‹å§‹ï¼ˆæ—¥æ›œï¼‰ã‚’å–å¾— ---- */
function getWeekStart(date) {
  const d = new Date(date);
  const day = d.getDay();
  d.setDate(d.getDate() - day); 
  return d;
}

/* ---- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æç”» ---- */
function renderWeek() {
  daysEl.innerHTML = "";

  let start = getWeekStart(current);
  let dates = [];

  for (let i = 0; i < 7; i++) {
    let d = new Date(start);
    d.setDate(start.getDate() + i);
    dates.push(d);
  }

  const first = dates[0];
  const last = dates[6];

  weekTitle.textContent = 
    `${first.getFullYear()}å¹´ ${first.getMonth()+1}æœˆ${first.getDate()}æ—¥ ã€œ ${last.getMonth()+1}æœˆ${last.getDate()}æ—¥`;

  const today = new Date();

  dates.forEach(d => {
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,"0");
    const day = String(d.getDate()).padStart(2,"0");
    const key = `${y}-${m}-${day}`;

    const count = history[key] ? history[key].length : 0;

    let stamp = "";
    if (count >= 100) {
      stamp = `<img src="images/stamp_gold.png" class="stamp">`;
    } else if (count >= 50) {
      stamp = `<img src="images/stamp_silver.png" class="stamp">`;
    }

    const isToday =
      d.getFullYear()===today.getFullYear() &&
      d.getMonth()===today.getMonth() &&
      d.getDate()===today.getDate();

    daysEl.innerHTML += `
      <div class="day ${isToday ? "today" : ""}">
        ${d.getDate()}
        <div class="count">${count}ã‹ã„</div>
        ${stamp}
      </div>
    `;
  });
}

/* ---- å‰ã®é€± / æ¬¡ã®é€± ---- */
document.getElementById("prev").onclick = () => {
  current.setDate(current.getDate() - 7);
  renderWeek();
};
document.getElementById("next").onclick = () => {
  current.setDate(current.getDate() + 7);
  renderWeek();
};

renderWeek();
</script>

</body>
</html>
