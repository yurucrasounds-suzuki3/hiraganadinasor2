<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>„Åò„ÇÜ„ÅÜ„Å°„Çá„ÅÜ</title>

<style>
  body {
    text-align: center;
    font-family: "Kosugi Maru", sans-serif;
    background: #fff6e0;
    margin: 0;
    padding: 0;
    overflow: hidden; /* ‚Üê „Çπ„ÇØ„É≠„Éº„É´Á¶ÅÊ≠¢ */
  }

  #backBtn {
    position: fixed;
    top: 10px;
    left: 10px;
    background: #4c8f3a;
    color: white;
    padding: 10px 15px;
    border-radius: 20px;
    text-decoration: none;
    z-index: 10;
  }

  h2 {
    color:#4c8f3a;
    font-size:24px;
    margin: 60px 0 5px;
  }

  #canvas {
    border: 4px solid #4c8f3a;
    background: white;
    border-radius: 20px;
    touch-action: none;
    display: block;
    margin: 0 auto;
  }

  .toolbar {
    position: fixed;
    bottom: 0;
    width: 100%;
    background: #fff6e0;
    padding: 8px 0 12px;
  }

  .btn {
    padding: 8px 14px;
    margin: 4px;
    background: #4c8f3a;
    color: white;
    border-radius: 10px;
    border: none;
    font-size: 14px;
  }

  .color-btn {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    border: 3px solid #fff;
    margin: 4px;
    box-shadow:0 0 4px rgba(0,0,0,0.3);
    cursor: pointer;
    display:inline-block;
  }
</style>
</head>

<body>

<a id="backBtn" href="index.html">‚Üê „ÇÇ„Å©„Çã</a>

<h2>„Åò„ÇÜ„ÅÜ„Å°„Çá„ÅÜ üñç</h2>

<canvas id="canvas"></canvas>

<div class="toolbar">
  <div>
    <span class="color-btn" style="background:red;" onclick="changeColor('red')"></span>
    <span class="color-btn" style="background:blue;" onclick="changeColor('blue')"></span>
    <span class="color-btn" style="background:#4c8f3a;" onclick="changeColor('#4c8f3a')"></span>
    <span class="color-btn" style="background:orange;" onclick="changeColor('orange')"></span>
    <span class="color-btn" style="background:black;" onclick="changeColor('black')"></span>
  </div>

  <button class="btn" onclick="setEraser()">„Åë„Åó„Ç¥„É†</button>
  <button class="btn" onclick="clearCanvas()">„Åú„Çì„Å∂„Åë„Åô</button>
  <button class="btn" onclick="saveImage()">„Åª„Åû„Çì</button>
</div>



<script>
let canvas = document.getElementById("canvas");
let ctx = canvas.getContext("2d");

let drawing = false;
let lastX = 0;
let lastY = 0;
let currentColor = "#4c8f3a"; 
let eraser = false;

/* ==============================
   üì± È´ò„Åï„Éî„ÉÉ„Çø„É™„Å´ canvas „ÇíÊúÄÂ§ßÂåñ
================================= */
function resizeCanvas() {
  const toolbar = document.querySelector('.toolbar').offsetHeight;
  const titleHeight = 95;  // Êàª„Çã + „Çø„Ç§„Éà„É´ÂàÜ

  const availableHeight = window.innerHeight - toolbar - titleHeight;

  canvas.width = window.innerWidth - 20;
  canvas.height = availableHeight;

  ctx.fillStyle = "white";
  ctx.fillRect(0, 0, canvas.width, canvas.height);
}

resizeCanvas();
window.addEventListener("resize", resizeCanvas);

/* ==============================
   ‚úçÔ∏è Êèè„ÅèÂá¶ÁêÜ
================================= */
canvas.addEventListener("pointerdown", e => {
  drawing = true;
  const rect = canvas.getBoundingClientRect();
  lastX = e.clientX - rect.left;
  lastY = e.clientY - rect.top;
});

canvas.addEventListener("pointerup", () => {
  drawing = false;
  ctx.beginPath();
});

canvas.addEventListener("pointermove", e => {
  if (!drawing) return;

  const rect = canvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;

  ctx.lineWidth = eraser ? 28 : 8;
  ctx.lineCap = "round";
  ctx.strokeStyle = eraser ? "white" : currentColor;

  ctx.lineTo(x, y);
  ctx.stroke();
  ctx.beginPath();
  ctx.moveTo(x, y);

  lastX = x;
  lastY = y;
});

/* Ëâ≤Â§âÊõ¥ */
function changeColor(color) {
  eraser = false;
  currentColor = color;
}

/* „Åë„Åó„Ç¥„É† */
function setEraser() {
  eraser = true;
}

/* ÂÖ®Ê∂à„Åó */
function clearCanvas() {
  ctx.fillStyle = "white";
  ctx.fillRect(0, 0, canvas.width, canvas.height);
}

/* ‰øùÂ≠ò */
function saveImage() {
  const url = canvas.toDataURL("image/png");
  const a = document.createElement("a");
  a.href = url;
  a.download = "jiyucho.png";
  a.click();
}
</script>

</body>
</html>
