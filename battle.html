<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>„Éê„Éà„É´</title>

<style>
  * { touch-action: manipulation; }

  body {
    background: linear-gradient(#ffe9b3 0%, #fff6e0 40%, #f2d39a 100%);
    font-family: "Kosugi Maru", sans-serif;
    margin: 0;
    padding-top: 20px;
    text-align: center;
    overflow: hidden;
  }
  #backBtn {
    position: fixed; top: 10px; left: 10px;
    background: #4c8f3a; color: white;
    padding: 10px 18px; border-radius: 20px;
    text-decoration: none; z-index: 10;
  }

  .battle-wrapper {
    width: 100%; max-width: 650px; margin: 0 auto;
  }
  .battle-area {
    display: flex; justify-content: space-between;
    align-items: center; width: 90%; margin: 10px auto;
  }

  .char { width: 40%; }
  .char img { width: 100%; max-width: 200px; }

  .ground {
    width: 80%; height: 20px;
    background: rgba(0,0,0,0.1);
    border-radius: 50%; margin: 0 auto 5px;
  }

  .hp-bar {
    width: 80%; height: 14px;
    background: #ccc; border-radius: 10px;
    margin: 4px auto 5px;
    overflow: hidden;
  }
  .hp-inner {
    height: 100%; background: #4c8f3a;
    transition: width 0.3s;
  }

  .char-name { font-size: 18px; margin-top: 2px; }

  #attackBtn {
    margin-top: 20px; padding: 20px 40px;
    background: #ff7f50; color: #fff;
    font-size: 28px; border: none;
    border-radius: 15px;
  }
  #attackBtn:active { transform: scale(0.95); }

  #log {
    background: #fff; width: 90%; max-width: 360px;
    margin: 20px auto; padding: 15px;
    height: 150px; overflow-y: auto;
    border-radius: 15px;
  }

  #popup {
    position: fixed; top: 50%; left: 50%;
    transform: translate(-50%, -50%) scale(0.6);
    background: white; padding: 25px 35px;
    border-radius: 20px; font-size: 24px;
    opacity: 0; pointer-events: none;
    transition: 0.3s; z-index: 99;
  }
  #popup.show {
    opacity: 1; transform: translate(-50%,-50%) scale(1);
  }
</style>
</head>

<body>

<a id="backBtn" href="index.html">‚Üê „Éõ„Éº„É†„Å∏</a>

<h2>„Éê„Éà„É´ÔºÅ</h2>

<div class="battle-wrapper">
  <div class="battle-area">

    <div class="char">
      <div class="ground"></div>
      <img id="playerImg">
      <div class="hp-bar"><div id="playerHp" class="hp-inner"></div></div>
      <div id="playerName" class="char-name"></div>
    </div>

    <div class="char">
      <div class="ground"></div>
      <img id="enemyImg">
      <div class="hp-bar"><div id="enemyHp" class="hp-inner"></div></div>
      <div id="enemyName" class="char-name"></div>
    </div>

  </div>
</div>

<button id="attackBtn" disabled>„Çà„Éº„ÅÑ‚Ä¶</button>
<div id="log"></div>
<div id="popup"></div>

<script>
const WIN_TAPS = 10;

/* Ëá™ÂàÜ„ÅÆ„Ç≠„É£„É©Ôºà„Å®„Çä„ÅÇ„Åà„Åö„ÉÜ„Ç£„É©„ÉéÔºâ */
const playerChar = {
  name: "„ÉÜ„Ç£„É©„Éé„Çµ„Ç¶„É´„Çπ",
  img: "images/tira.png"
};

/* Êïµ„Ç≠„É£„É©Ôºà„Åä„Å´Ôºâ */
const enemyChar = {
  name: "„ÅÇ„Åã„Åä„Å´",
  img: "images/oni.png"
};

/* Ë°®Á§∫Âá¶ÁêÜ */
document.getElementById("playerImg").src = playerChar.img;
document.getElementById("playerName").textContent = playerChar.name;
document.getElementById("enemyImg").src = enemyChar.img;
document.getElementById("enemyName").textContent = enemyChar.name;

let playerHP = 100;
let enemyHP  = 100;

function updateHp() {
  document.getElementById("playerHp").style.width = playerHP + "%";
  document.getElementById("enemyHp").style.width  = enemyHP + "%";
}
updateHp();

/* „É≠„Ç∞ */
function log(t){
  const box = document.getElementById("log");
  box.innerHTML += t + "<br>";
  box.scrollTop = box.scrollHeight;
}

/* „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó */
function showPopup(t){
  const p = document.getElementById("popup");
  p.textContent = t;
  p.classList.add("show");
  setTimeout(()=>p.classList.remove("show"),1500);
}

/* „Éê„Éà„É´Âá¶ÁêÜ */
let tapCount = 0;
let timeLeft = 5;

const attackBtn = document.getElementById("attackBtn");

/* ÊîªÊíÉÔºà„Çø„ÉÉ„ÉóÔºâ */
attackBtn.addEventListener("click", ()=>{
  tapCount++;
  log("„Åì„ÅÜ„Åí„ÅçÔºÅ");
});

/* „Ç´„Ç¶„É≥„Éà„ÉÄ„Ç¶„É≥ */
let startCount = 3;
const startInterval = setInterval(()=>{
  attackBtn.textContent = "„Çà„Éº„ÅÑ‚Ä¶" + startCount;
  startCount--;

  if(startCount < 0){
    clearInterval(startInterval);
    startBattle();
  }
}, 1000);

/* „Éê„Éà„É´ÈñãÂßã */
function startBattle(){
  attackBtn.disabled = false;
  attackBtn.textContent = "„Åì„ÅÜ„Åí„ÅçÔºÅÔºà5Ôºâ";

  const timer = setInterval(()=>{
    timeLeft--;
    attackBtn.textContent = `„Åì„ÅÜ„Åí„ÅçÔºÅÔºà${timeLeft}Ôºâ`;

    if(timeLeft <= 0){
      clearInterval(timer);
      attackBtn.disabled = true;
      finishBattle();
    }
  }, 1000);
}

/* ÁµêÊûúÂá¶ÁêÜ */
function finishBattle(){
  enemyHP = Math.max(0, 100 - tapCount * 5);
  updateHp();

  log(`„ÅÇ„Å™„Åü„ÅÆ„Çø„ÉÉ„Éó„Åô„ÅÜÔºö${tapCount} „Åã„ÅÑ`);

  if(tapCount >= WIN_TAPS){
    log("„ÅÇ„Å™„Åü„ÅÆ„Åã„Å°ÔºÅÔºÅüéâ");
    showPopup("üéâ „Åã„Å£„Åü„ÇàÔºÅÔºÅ");

    /* ‚òÖ ÂãùÂà© ‚Üí „ÉÅ„Ç±„ÉÉ„Éà +1 ‚òÖ */
    let t = Number(localStorage.getItem("specialTicket") || 0);
    localStorage.setItem("specialTicket", t + 1);

    /* „Ç¨„ÉÅ„É£„Å∏ */
    setTimeout(()=>{
      location.href = "special_gacha.html";
    }, 1200);

  } else {
    log("„Å≤„Åç„Çè„ÅëÔºÅ");
    showPopup("„Å≤„Åç„Çè„ÅëÔºÅ");
  }
}
</script>

</body>
</html>
